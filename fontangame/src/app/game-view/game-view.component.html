@switch (currentScreen) {
    @case ('menu'){
    <h1>Menu</h1>
    <mat-form-field>
      <mat-label>Difficulty</mat-label>
      <mat-select [(value)]="targetScore" required>
        <mat-option value="100">Easy</mat-option>
        <mat-option value="200">Medium</mat-option>
        <mat-option value="300">Hard</mat-option>
      </mat-select>
    </mat-form-field>
    <p>Target Score: {{ targetScore }}</p>
    <button mat-raised-button (click)="StartConnecting()">Connect</button>
    }
    @case ('game'){
        <h1>Game</h1>
        <div id="gameLayout">
            <div>
                <h2>Score: {{ score }}</h2>
                <h2> @if (multiplier > 1){Multiplier: {{ multiplier }} | Remaining: {{ bonusTime }}} </h2>
                <h2>Time Remaining: {{ timeRemaining }} seconds</h2>
                <p>HR: {{ curBpm }} BPM</p>
                <p>SpO2: {{ curspo2 }} %</p>
            </div>
            <div id="missionDiv">
                <!--This implementation forces us to have both missions (see the ts comment)-->
                <div class="missionBox">
                    <h2>Complete the Session without Pausing</h2>
                    @if(noPauseMission?.IsCompleted) {
                        <mat-progress-bar mode="buffer"></mat-progress-bar>
                        <h3> </h3>
                    } @else {
                        <mat-progress-bar mode="determinate" [value]="100" color="warn"></mat-progress-bar>
                        <h3 style="color: red;">Mission Failed</h3>
                    }
                </div>
                <div class="missionBox">
                    <h2>Stay above {{ comboMission?.ComboTarget }} for {{ comboMission?.ComboTime }} seconds</h2>
                    @if (comboMission?.IsCompleted) {
                        <mat-progress-bar mode="determinate" class="mat-progress-bar-green"></mat-progress-bar>
                        <h3 style="color: green;">Mission Completed</h3>
                    } @else {
                        <mat-progress-bar mode="determinate" [value]="(comboMission?.ComboCounter! / comboMission?.ComboTime! * 100)"></mat-progress-bar>
                        <h3> </h3>
                    }
                </div>
            </div>
        </div>
        @if (timeSinceLastUpdate > 3) {
          <h2 style="color: red">Warning: No updates from Pipo in the last {{ timeSinceLastUpdate }} seconds!</h2>
        }

        <button mat-raised-button (click)="PauseGame()">Pause</button>
    }
    @case ('connecting'){
        @if (gameRunning) {
            <h1>Connection to Pipo Lost</h1>
        } @else {
            <h1>Connecting</h1>
        }
        <p>MQTT {{ MqttClientService.MqttConnected ? 'Connected' : 'Disconnected' }}</p>
        <p>Pipo {{ MqttClientService.PipoConnected ? 'Connected' : 'Disconnected' }}</p>

        @if (gameRunning) {
            <button mat-raised-button [disabled]="!MqttClientService.MqttConnected || !MqttClientService.PipoConnected" (click)="ResumeGame()">Resume Game</button>
        } @else {
            <button mat-raised-button [disabled]="!MqttClientService.MqttConnected || !MqttClientService.PipoConnected" (click)="StartGame()">Start Game</button>
            <button mat-raised-button (click)="BackFromConnecting()">Back</button>
        }
    }
    @case ('pause'){
        <h1>Game Paused</h1>
        <p>Score: {{ score }}</p>
        <p>Time Remaining: {{ timeRemaining }} seconds</p>
        <p>HR: {{ curBpm }} BPM</p>
        <p>SpO2: {{ curspo2 }} %</p>
        <button mat-raised-button (click)="ResumeGame()">Resume Game</button>
        <button mat-raised-button (click)="QuitToMenu()">Return to Menu</button>
    }
    @case ('gameOver') {
        @if(didWin) {
            <h1>Congratulations! You won! ðŸŽ‰</h1>
        } @else {
            <h1>You lost!</h1>
        }
        <h2>Final Score: {{ score }}</h2>
        <h1>Average BPM: {{ bpmStore.GetAvgBpm() }}</h1>
        <h1>Average SpO2: {{ spo2Store.GetAvgSpo2() }}</h1>
        <button mat-raised-button (click)="ReturnToMenu()">Return to Menu</button>
    }
}
